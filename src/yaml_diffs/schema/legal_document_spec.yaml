# OpenSpec Schema Definition for Hebrew Legal Documents
# Version: 1.0.0
# Format: JSON Schema (Draft 2020-12) in YAML format
#
# This schema defines the structure for legal and regulatory documents
# with recursive sections, supporting unlimited nesting depth.

version: "1.0.0"
$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://github.com/noamoss/yaml_diffs/schema/legal_document_spec.yaml"

title: "Legal Document Schema"
description: |
  Schema for representing Hebrew legal and regulatory documents in YAML format.
  Supports recursive sections with unlimited nesting, flexible structural markers,
  and stable IDs for change detection across versions.

type: object
required:
  - document

properties:
  document:
    type: object
    required:
      - id
      - title
      - type
      - language
      - version
      - source
      - sections
    properties:
      id:
        type: string
        description: "Stable document identifier (recommended: UUID or canonical ID)"
        minLength: 1
        examples:
          - "law-1234"
          - "550e8400-e29b-41d4-a716-446655440000"

      title:
        type: string
        description: "Document title in Hebrew"
        minLength: 1

      type:
        type: string
        description: "Type of legal document"
        enum:
          - law
          - regulation
          - directive
          - circular
          - policy
          - other
        examples:
          - "law"
          - "regulation"

      language:
        type: string
        description: "Document language (must be 'hebrew')"
        const: "hebrew"
        default: "hebrew"

      version:
        type: object
        required:
          - number
        properties:
          number:
            type: string
            description: "Version identifier or date (e.g., '2024-11-01')"
            minLength: 1
            examples:
              - "2024-11-01"
              - "v1.0"
          description:
            type: string
            description: "Optional version description"
        additionalProperties: false

      source:
        type: object
        required:
          - url
          - fetched_at
        properties:
          url:
            type: string
            description: "Original source URL"
            format: uri
            minLength: 1
            examples:
              - "https://example.gov.il/law1234"
          fetched_at:
            type: string
            description: "ISO 8601 timestamp when document was fetched"
            format: date-time
            examples:
              - "2025-01-20T09:50:00Z"
        additionalProperties: false

      sections:
        type: array
        description: "Recursive array of document sections"
        items:
          $ref: "#/$defs/Section"
        minItems: 0

      authors:
        type: array
        description: "Optional list of authors, entities, or organizations"
        items:
          type: string
        examples:
          - ["הכנסת", "משרד המשפטים"]

      published_date:
        type: string
        description: "Optional publication date in ISO 8601 format"
        format: date-time
        examples:
          - "1992-03-17"
          - "1992-03-17T00:00:00Z"

      updated_date:
        type: string
        description: "Optional last update date in ISO 8601 format"
        format: date-time
        examples:
          - "2024-01-15"
          - "2024-01-15T10:30:00Z"

    additionalProperties: false

$defs:
  Section:
    type: object
    description: |
      Recursive section definition. Sections can contain nested sections
      to unlimited depth. Each section must have a stable ID and a marker
      for diffing. Markers are the primary identifiers used for matching
      sections across document versions.
    required:
      - id
      - marker
      - sections
    properties:
      id:
        type: string
        description: "Stable section identifier (required for tracking)"
        # Pattern supports alphanumeric characters, hyphens, and underscores.
        # This allows for UUIDs (e.g., "550e8400-e29b-41d4-a716-446655440000")
        # as well as custom identifiers (e.g., "sec-1", "sec-1-a").
        pattern: "^[a-zA-Z0-9_-]+$"
        minLength: 1
        examples:
          - "sec-1"
          - "sec-1-a"
          - "550e8400-e29b-41d4-a716-446655440000"

      marker:
        type: string
        description: |
          Required structural marker (e.g., "1", "1.א", "(b)", "II", "א'").
          Markers are the primary identifiers used for diffing sections across
          document versions. Preserved verbatim for citation purposes.
          Must be unique within the same nesting level.
        minLength: 1
        examples:
          - "1"
          - "1.א"
          - "(א)"
          - "II"
          - "פרק א'"

      title:
        type: string
        description: "Optional section title in Hebrew"
        examples:
          - "הגדרות"
          - "תחולה"

      content:
        type: string
        description: |
          Text content of this section only (excluding subsections).
          Defaults to empty string if not provided.
        default: ""

      sections:
        type: array
        description: "Recursive array of nested sections"
        items:
          $ref: "#/$defs/Section"
        minItems: 0

    additionalProperties: false
